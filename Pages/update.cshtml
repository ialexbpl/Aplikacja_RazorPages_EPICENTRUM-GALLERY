@page  
@model Aplikacja_RazorPages.Pages.UpdateModel  
@{  
   ViewData["Title"] = "Edit Painting";  
}  

<h3>Edit Painting</h3>  

<div class="form-group">  
   <label for="paintingDropdown">Select a Painting</label>  
   <select id="paintingDropdown" class="form-control" onchange="loadPainting(this.value)">  
       <option value="">-- Select a Painting --</option>  

       @foreach (var painting in Model.Paintings)  
       {
            <option value="@painting.Id" selected="@(Model.painting != null && Model.painting.Id == painting.Id ? "selected" : null)">
                @painting.Name by @painting.Author  
           </option>  
       }  
   </select>  
</div>  

@if (Model.painting != null)
{  
   <form method="post" enctype="multipart/form-data">
        <div class="mb-2 text-muted small">
            <strong>Painting ID:</strong> @Model.painting.Id
        </div>

        <input type="hidden" asp-for="painting.Id" />

        <div class="form-group">
            <label asp-for="painting.Name">Name</label>
            <input asp-for="painting.Name" class="form-control" />
        </div>  

       <div class="form-group">
            <label asp-for="painting.Author">Author</label>
            <input asp-for="painting.Author" class="form-control" />
        </div>  

       <div class="form-group">
            <label asp-for="painting.Description">Description</label>
            <textarea asp-for="painting.Description" class="form-control"></textarea>
        </div>  

       <div class="form-group">
            <label asp-for="painting.Price">Price</label>
            <input asp-for="painting.Price" type="number" class="form-control" />
        </div>  

       <div class="form-group">  
           <label asp-for="PhotoFile">Image</label>  
           <input type="file" asp-for="PhotoFile" class="form-control" accept="image/*" onchange="previewImage(event)" />
            <img id="imagePreview" src="@($"data:image/png;base64,{Convert.ToBase64String(Model.painting.Image ?? new byte[0])}")" alt="Image Preview" style="max-width: 300px; max-height: 300px; margin-top: 10px;" />
        </div>  

       <div class="d-flex justify-content-start mt-3">  
           <button type="submit" class="btn btn-primary me-2">Save</button>
            <button type="submit" class="btn btn-danger" asp-page-handler="Delete" asp-route-id=@Model.painting.Id onclick="confirmDelete('@Model.painting.Id')">Delete</button>
        </div>  
   </form>  
}  

<script>  
   function loadPainting(id) {  
       if (id) {  
           const url = `?handler=LoadPainting&id=${id}`;  
           window.location.href = url;  
       }  
   }  

   function previewImage(event) {  
       const input = event.target;  
       const preview = document.getElementById('imagePreview');  

       if (input.files && input.files[0]) {  
           const reader = new FileReader();  

           reader.onload = function (e) {  
               preview.src = e.target.result;  
               preview.style.display = 'block';  
           };  

           reader.readAsDataURL(input.files[0]);  
       } else {  
           preview.src = '#';  
           preview.style.display = 'none';  
       }  
   }

     function confirmDelete(id) {
        if (confirm("Are you sure you want to delete this painting?")) {
            const url = `?handler=Delete&id=${id}`;
            window.location.href = url;
        }
        
    }
    
</script>
